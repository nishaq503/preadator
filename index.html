
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="about/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Preadator Docs</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep_orange" data-md-color-accent="deep_orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preadator.ProcessManager" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Preadator Docs" class="md-header__button md-logo" aria-label="Preadator Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Preadator Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Preadator Docs" class="md-nav__button md-logo" aria-label="Preadator Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Preadator Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager" class="md-nav__link">
    ProcessManager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.debug" class="md-nav__link">
    debug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.log_level" class="md-nav__link">
    log_level
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.name" class="md-nav__link">
    name
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.num_active_threads" class="md-nav__link">
    num_active_threads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.num_available_cpus" class="md-nav__link">
    num_available_cpus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.num_processes" class="md-nav__link">
    num_processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.processes" class="md-nav__link">
    processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.threads" class="md-nav__link">
    threads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.threads_per_process" class="md-nav__link">
    threads_per_process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.acquire_process" class="md-nav__link">
    acquire_process()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.acquire_thread" class="md-nav__link">
    acquire_thread()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.join_processes" class="md-nav__link">
    join_processes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.join_threads" class="md-nav__link">
    join_threads()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.shutdown" class="md-nav__link">
    shutdown()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.submit" class="md-nav__link">
    submit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.submit_process" class="md-nav__link">
    submit_process()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.submit_thread" class="md-nav__link">
    submit_thread()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    Acknowledgements
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager" class="md-nav__link">
    ProcessManager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.debug" class="md-nav__link">
    debug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.log_level" class="md-nav__link">
    log_level
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.name" class="md-nav__link">
    name
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.num_active_threads" class="md-nav__link">
    num_active_threads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.num_available_cpus" class="md-nav__link">
    num_available_cpus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.num_processes" class="md-nav__link">
    num_processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.processes" class="md-nav__link">
    processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.threads" class="md-nav__link">
    threads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.threads_per_process" class="md-nav__link">
    threads_per_process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.acquire_process" class="md-nav__link">
    acquire_process()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.acquire_thread" class="md-nav__link">
    acquire_thread()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.join_processes" class="md-nav__link">
    join_processes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.join_threads" class="md-nav__link">
    join_threads()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.shutdown" class="md-nav__link">
    shutdown()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.submit" class="md-nav__link">
    submit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.submit_process" class="md-nav__link">
    submit_process()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preadator.ProcessManager.submit_thread" class="md-nav__link">
    submit_thread()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    Acknowledgements
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Home</h1>

<p>This site contains documentation for the <code>ProcessManager</code> from the <code>preadator</code> package.</p>


<div class="doc doc-object doc-class">



<a id="preadator.ProcessManager"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><span title="concurrent.futures.Executor">Executor</span></code></p>

  
      <p>Manages processes and threads.</p>
<p>The ProcessManager class is a singleton class that manages processes and
threads. It is a subclass of concurrent.futures.Executor and can be used
as such. It is also a context manager and can be used as such.</p>



<p><strong>Examples:</strong></p>
    <p>The <code>ProcessManager</code> is meant to be a drop-in replacement for
<code>concurrent.futures.ProcessPoolExecutor</code> and
<code>concurrent.futures.ThreadPoolExecutor</code>. The intent is to minimize the
configuration (ant thought behind said configuration) required to run
code in parallel.</p>
<p>The following example shows how to use the <code>ProcessManager</code> as a context
manager.</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">preadator</span> <span class="kn">import</span> <span class="n">ProcessManager</span>
</code></pre></div>
    <ul>
<li>This example shows how we can submit jobs as processes to the
internal ProcessPoolExecutor.</li>
</ul>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ProcessManager</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;PM_with_processes&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">num_processes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">threads_per_process</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span> <span class="k">as</span> <span class="n">pm</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>    <span class="c1"># Submit the jobs as processes.</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">submit_process</span><span class="p">(</span><span class="n">factorial</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<span class="gp">... </span>    <span class="c1"># Wait for all processes to finish.</span>
<span class="gp">... </span>    <span class="n">pm</span><span class="o">.</span><span class="n">join_processes</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">]</span>
<span class="gp">... </span>    <span class="c1"># Print the results.</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="go">[1, 1, 2, 6, 24, 120, 720]</span>
</code></pre></div>
    <ul>
<li>This example shows how we can submit jobs as threads to the
internal ThreadPoolExecutor.</li>
</ul>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ProcessManager</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;PM_with_threads&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">num_processes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">threads_per_process</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span> <span class="k">as</span> <span class="n">pm</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>    <span class="c1"># Submit the jobs as threads.</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">submit_thread</span><span class="p">(</span><span class="n">factorial</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<span class="gp">... </span>    <span class="c1"># Wait for all threads to finish.</span>
<span class="gp">... </span>    <span class="n">pm</span><span class="o">.</span><span class="n">join_threads</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">]</span>
<span class="gp">... </span>    <span class="c1"># Print the results.</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="go">[1, 1, 2, 6, 24, 120, 720]</span>
</code></pre></div>
    <ul>
<li>This example shows how we can initialize several <code>ProcessManager</code>
nested within each other.</li>
</ul>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>       <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fibonacci() not defined for negative values&quot;</span><span class="p">)</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<span class="gp">... </span>       <span class="k">return</span> <span class="n">n</span>
<span class="gp">... </span>   <span class="k">with</span> <span class="n">ProcessManager</span><span class="p">(</span>
<span class="gp">... </span>       <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;PM_Fibonacci(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
<span class="gp">... </span>       <span class="n">num_processes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="gp">... </span>       <span class="n">threads_per_process</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>   <span class="p">)</span> <span class="k">as</span> <span class="n">pm</span><span class="p">:</span>
<span class="gp">... </span>       <span class="n">f_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">submit_process</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>       <span class="n">f_2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">submit_process</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>       <span class="n">pm</span><span class="o">.</span><span class="n">join_processes</span><span class="p">()</span>
<span class="gp">... </span>       <span class="k">return</span> <span class="n">f_1</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="o">+</span> <span class="n">f_2</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="go">55</span>
</code></pre></div>
    <ul>
<li>This example shows that the <code>ProcessManager</code> will catch and raise
exceptions.</li>
</ul>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ProcessManager</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;PM_with_errors&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">num_processes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">threads_per_process</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span> <span class="k">as</span> <span class="n">pm</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>    <span class="c1"># Submit the jobs as processes.</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">submit_process</span><span class="p">(</span><span class="n">factorial</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<span class="gp">... </span>    <span class="c1"># Wait for all processes to finish.</span>
<span class="gp">... </span>    <span class="n">pm</span><span class="o">.</span><span class="n">join_processes</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">ValueError</span>: <span class="n">factorial() not defined for negative values</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProcessManager</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Executor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages processes and threads.</span>

<span class="sd">    The ProcessManager class is a singleton class that manages processes and</span>
<span class="sd">    threads. It is a subclass of concurrent.futures.Executor and can be used</span>
<span class="sd">    as such. It is also a context manager and can be used as such.</span>

<span class="sd">    Examples:</span>
<span class="sd">        The `ProcessManager` is meant to be a drop-in replacement for</span>
<span class="sd">        `concurrent.futures.ProcessPoolExecutor` and</span>
<span class="sd">        `concurrent.futures.ThreadPoolExecutor`. The intent is to minimize the</span>
<span class="sd">        configuration (ant thought behind said configuration) required to run</span>
<span class="sd">        code in parallel.</span>

<span class="sd">        The following example shows how to use the `ProcessManager` as a context</span>
<span class="sd">        manager.</span>

<span class="sd">        &gt;&gt;&gt; from math import factorial</span>
<span class="sd">        &gt;&gt;&gt; from preadator import ProcessManager</span>

<span class="sd">        - This example shows how we can submit jobs as processes to the</span>
<span class="sd">        internal ProcessPoolExecutor.</span>

<span class="sd">        &gt;&gt;&gt; with ProcessManager(</span>
<span class="sd">        ...     name=&quot;PM_with_processes&quot;,</span>
<span class="sd">        ...     num_processes=4,</span>
<span class="sd">        ...     threads_per_process=2,</span>
<span class="sd">        ... ) as pm:</span>
<span class="sd">        ...     futures = []</span>
<span class="sd">        ...     # Submit the jobs as processes.</span>
<span class="sd">        ...     for i in range(7):</span>
<span class="sd">        ...         futures.append(pm.submit_process(factorial, i))</span>
<span class="sd">        ...     # Wait for all processes to finish.</span>
<span class="sd">        ...     pm.join_processes()</span>
<span class="sd">        ...     results = [f.result() for f in futures]</span>
<span class="sd">        ...     # Print the results.</span>
<span class="sd">        ...     print(results)</span>
<span class="sd">        [1, 1, 2, 6, 24, 120, 720]</span>

<span class="sd">        - This example shows how we can submit jobs as threads to the</span>
<span class="sd">        internal ThreadPoolExecutor.</span>

<span class="sd">        &gt;&gt;&gt; with ProcessManager(</span>
<span class="sd">        ...     name=&quot;PM_with_threads&quot;,</span>
<span class="sd">        ...     num_processes=4,</span>
<span class="sd">        ...     threads_per_process=2,</span>
<span class="sd">        ... ) as pm:</span>
<span class="sd">        ...     futures = []</span>
<span class="sd">        ...     # Submit the jobs as threads.</span>
<span class="sd">        ...     for i in range(7):</span>
<span class="sd">        ...         futures.append(pm.submit_thread(factorial, i))</span>
<span class="sd">        ...     # Wait for all threads to finish.</span>
<span class="sd">        ...     pm.join_threads()</span>
<span class="sd">        ...     results = [f.result() for f in futures]</span>
<span class="sd">        ...     # Print the results.</span>
<span class="sd">        ...     print(results)</span>
<span class="sd">        [1, 1, 2, 6, 24, 120, 720]</span>

<span class="sd">        - This example shows how we can initialize several `ProcessManager`</span>
<span class="sd">        nested within each other.</span>

<span class="sd">        &gt;&gt;&gt; def fibonacci(n: int) -&gt; int:</span>
<span class="sd">        ...    if n &lt; 0:</span>
<span class="sd">        ...        raise ValueError(&quot;fibonacci() not defined for negative values&quot;)</span>
<span class="sd">        ...    if n &lt; 2:</span>
<span class="sd">        ...        return n</span>
<span class="sd">        ...    with ProcessManager(</span>
<span class="sd">        ...        name=f&quot;PM_Fibonacci({n})&quot;,</span>
<span class="sd">        ...        num_processes=4,</span>
<span class="sd">        ...        threads_per_process=2,</span>
<span class="sd">        ...    ) as pm:</span>
<span class="sd">        ...        f_1 = pm.submit_process(fibonacci, n - 1)</span>
<span class="sd">        ...        f_2 = pm.submit_process(fibonacci, n - 2)</span>
<span class="sd">        ...        pm.join_processes()</span>
<span class="sd">        ...        return f_1.result() + f_2.result()</span>
<span class="sd">        &gt;&gt;&gt; print(fibonacci(9))</span>
<span class="sd">        55</span>

<span class="sd">        - This example shows that the `ProcessManager` will catch and raise</span>
<span class="sd">        exceptions.</span>

<span class="sd">        &gt;&gt;&gt; with ProcessManager(</span>
<span class="sd">        ...     name=&quot;PM_with_errors&quot;,</span>
<span class="sd">        ...     num_processes=4,</span>
<span class="sd">        ...     threads_per_process=2,</span>
<span class="sd">        ... ) as pm:</span>
<span class="sd">        ...     futures = []</span>
<span class="sd">        ...     # Submit the jobs as processes.</span>
<span class="sd">        ...     for i in range(4, -4, -2):</span>
<span class="sd">        ...         futures.append(pm.submit_process(factorial, i))</span>
<span class="sd">        ...     # Wait for all processes to finish.</span>
<span class="sd">        ...     pm.join_processes()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        ValueError: factorial() not defined for negative values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_unique_manager</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The unique ProcessManager instance.</span>

<span class="sd">    This is a class attribute that is used to ensure that only one instance of</span>
<span class="sd">    the ProcessManager class is ever created. This instance will be reused if</span>
<span class="sd">    the ProcessManager class is instantiated more than once.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">log_level</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PREADATOR_LOG_LEVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The logging level of the ProcessManager.</span>

<span class="sd">    This is controlled by the PREADATOR_LOG_LEVEL environment variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PREADATOR_DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to run in debug mode.</span>

<span class="sd">    This is controlled by the PREADATOR_DEBUG environment variable.</span>

<span class="sd">    In debug mode, the ProcessManager will run all submitted jobs in the main</span>
<span class="sd">    process and thread. It still returns the results using futures, as if they</span>
<span class="sd">    were run in parallel, but it does not actually run them in parallel. This is</span>
<span class="sd">    useful for debugging when, for example, you want to attach a debugger, or if</span>
<span class="sd">    you want to find out whether a bug is caused by running code in parallel, or</span>
<span class="sd">    because of dependencies between the processes/threads, or because of</span>
<span class="sd">    something else.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ProcessManager&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The name of the ProcessManager&#39;s main logger.&quot;&quot;&quot;</span>

    <span class="n">_main_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The main logger of the ProcessManager.&quot;&quot;&quot;</span>

    <span class="n">_main_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="n">_job_name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The name of the current job.&quot;&quot;&quot;</span>

    <span class="n">_job_logger</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The logger of the current job.&quot;&quot;&quot;</span>

    <span class="n">_process_executor</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The ProcessPoolExecutor instance.&quot;&quot;&quot;</span>

    <span class="n">processes</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The list of process futures.&quot;&quot;&quot;</span>

    <span class="n">_thread_executor</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The ThreadPoolExecutor instance.&quot;&quot;&quot;</span>

    <span class="n">threads</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The list of thread futures.&quot;&quot;&quot;</span>

    <span class="n">num_active_threads</span><span class="p">:</span> <span class="nb">int</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The number of active threads.&quot;&quot;&quot;</span>

    <span class="n">num_active_threads</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">num_available_cpus</span><span class="p">:</span> <span class="nb">int</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The number of available CPUs.&quot;&quot;&quot;</span>

    <span class="n">num_available_cpus</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

    <span class="n">num_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_available_cpus</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The maximum number of processes.</span>

<span class="sd">    This is set to half the number of available CPUs by default. This is because</span>
<span class="sd">    the number of processes is usually limited by the number of available CPUs</span>
<span class="sd">    and each process can run, for example, IO-bound tasks in different threads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">threads_per_process</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_available_cpus</span> <span class="o">//</span> <span class="n">num_processes</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The number of threads per process that can be run.</span>

<span class="sd">    This default is set so that the product of the number of processes and the</span>
<span class="sd">    number of threads per process is equal to the number of available CPUs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_threads_per_request</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">threads_per_process</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The number of threads per request.</span>

<span class="sd">    This is used to manage the redistribution of threads between processes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether the ProcessManager is running.&quot;&quot;&quot;</span>

    <span class="n">_process_queue</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The process queue.&quot;&quot;&quot;</span>

    <span class="n">_process_names</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The process names queue.&quot;&quot;&quot;</span>

    <span class="n">_process_ids</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The process IDs queue.&quot;&quot;&quot;</span>

    <span class="n">_thread_queue</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The thread queue.&quot;&quot;&quot;</span>

    <span class="n">_thread_names</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The thread names queue.&quot;&quot;&quot;</span>

    <span class="n">_thread_ids</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The thread IDs queue.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002, ARG003</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003, ARG003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProcessManager&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new ProcessManager instance if none exists.</span>

<span class="sd">        Otherwise, returns the existing instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A unique ProcessManager instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_manager</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_manager</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">process_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the process manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the ProcessManager.</span>
<span class="sd">            process_names: The names of the processes.</span>
<span class="sd">            **kwargs: See below</span>

<span class="sd">        Keyword Args:</span>
<span class="sd">            log_level (str): The logging level of the ProcessManager.</span>
<span class="sd">            num_processes (int): The maximum number of processes.</span>
<span class="sd">            threads_per_process (int): The number of threads per process that can</span>
<span class="sd">            be run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check kwargs.</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid initializer argument: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Make sure that the ProcessManager is not already running.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;ProcessManager is already running. Try shutting it down first.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Change the name of the logger.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

        <span class="c1"># Start the Process Manager.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Starting ProcessManager with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="si">}</span><span class="s2"> processes ...&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create the process name queue.</span>
        <span class="k">if</span> <span class="n">process_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">process_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Process </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">process_names</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Number of process names must be equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_names</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">process_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_names</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">p_name</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>

        <span class="c1"># Create the process queue and populate it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threads_per_process</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]  # noqa: E501</span>

        <span class="c1"># Create the process IDs queue.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_ids</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

        <span class="c1"># Create the process executor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>

        <span class="c1"># Create the thread executor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
            <span class="n">num_threads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads_per_process</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_threads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Starting the thread pool with </span><span class="si">{</span><span class="n">num_threads</span><span class="si">}</span><span class="s2"> threads ...&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]  # noqa: E501</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_active_threads</span> <span class="o">=</span> <span class="n">num_threads</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initializer</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initializer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">**</span><span class="n">init_args</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Initialize the process.</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">init_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_job_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]  # noqa: E501</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_ids</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Process </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_name</span><span class="si">}</span><span class="s2"> initialized with PID </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">acquire_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProcessLock&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Acquires a lock for the current process.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ProcessLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>

    <span class="k">def</span> <span class="nf">acquire_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ThreadLock&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Acquires a lock for the current thread.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ThreadLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>

    <span class="k">def</span> <span class="nf">submit_process</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fn</span><span class="p">,</span>  <span class="c1"># noqa: ANN001</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submits a callable to be executed with the given arguments.</span>

<span class="sd">        Schedules the callable to be executed as fn(*args, **kwargs) and returns</span>
<span class="sd">        a Future instance representing the execution of the callable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Future representing the given call.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="k">def</span> <span class="nf">submit_thread</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fn</span><span class="p">,</span>  <span class="c1"># noqa: ANN001</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submits a callable to be executed with the given arguments.</span>

<span class="sd">        Schedules the callable to be executed as fn(*args, **kwargs) and returns</span>
<span class="sd">        a Future instance representing the execution of the callable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Future representing the given call.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fn</span><span class="p">,</span>  <span class="c1"># noqa: ANN001</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This defaults to `submit_process`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_process</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">join_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Waits for all processes to finish.</span>

<span class="sd">        Args:</span>
<span class="sd">            update_period: The time in seconds between updates on the progress</span>
<span class="sd">            of the processes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No processes to join.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">update_period</span><span class="p">,</span>
                <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_EXCEPTION</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">p</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">progress</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processes progress: </span><span class="si">{</span><span class="n">progress</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">% ...&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All processes finished.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors occurred during process join. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The first is: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">join_threads</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912, C901</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">update_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Waits for all threads to finish.</span>

<span class="sd">        Args:</span>
<span class="sd">            update_period: The time in seconds between updates on the progress</span>
<span class="sd">            of the threads.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No threads to join.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">update_period</span><span class="p">,</span>
                <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_EXCEPTION</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">progress</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Threads progress: </span><span class="si">{</span><span class="n">progress</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">% ...&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All threads finished.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="c1"># Steal threads from available processes.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_active_threads</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">num_new_threads</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="mi">0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">threads_per_process</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">,</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                            <span class="n">num_new_threads</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span>

                <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">num_new_threads</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_active_threads</span> <span class="o">+=</span> <span class="n">num_new_threads</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Stole </span><span class="si">{</span><span class="n">num_new_threads</span><span class="si">}</span><span class="s2"> threads from processes.&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors occurred during thread join. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The first is: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912 (too-many-branches (13 &gt; 12))</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">cancel_futures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean-up the resources associated with the Executor.</span>

<span class="sd">        It is safe to call this method several times. Otherwise, no other</span>
<span class="sd">        methods can be called after this one.</span>

<span class="sd">        Args:</span>
<span class="sd">            wait: Whether to wait for all processes and threads to finish.</span>
<span class="sd">            cancel_futures: Whether to cancel pending futures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shutting down the thread pool ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="n">cancel_futures</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shutting down the process pool ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="n">cancel_futures</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">p</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">join_threads</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_processes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors occurred during shutdown. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The first is: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.debug" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">debug</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PREADATOR_DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Whether to run in debug mode.</p>
<p>This is controlled by the PREADATOR_DEBUG environment variable.</p>
<p>In debug mode, the ProcessManager will run all submitted jobs in the main
process and thread. It still returns the results using futures, as if they
were run in parallel, but it does not actually run them in parallel. This is
useful for debugging when, for example, you want to attach a debugger, or if
you want to find out whether a bug is caused by running code in parallel, or
because of dependencies between the processes/threads, or because of
something else.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.log_level" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">log_level</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PREADATOR_LOG_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The logging level of the ProcessManager.</p>
<p>This is controlled by the PREADATOR_LOG_LEVEL environment variable.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.name" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ProcessManager&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The name of the ProcessManager's main logger.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.num_active_threads" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_active_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_threads</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The number of active threads.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.num_available_cpus" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_available_cpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The number of available CPUs.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.num_processes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">num_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_available_cpus</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The maximum number of processes.</p>
<p>This is set to half the number of available CPUs by default. This is because
the number of processes is usually limited by the number of available CPUs
and each process can run, for example, IO-bound tasks in different threads.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.processes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The list of process futures.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.threads" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The list of thread futures.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="preadator.ProcessManager.threads_per_process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">threads_per_process</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_available_cpus</span> <span class="o">//</span> <span class="n">num_processes</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>The number of threads per process that can be run.</p>
<p>This default is set so that the product of the number of processes and the
number of threads per process is equal to the number of available CPUs.</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">process_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Initializes the process manager.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the ProcessManager.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>process_names</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[list[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The names of the processes.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>See below</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Other Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>log_level</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The logging level of the ProcessManager.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>num_processes</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum number of processes.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>threads_per_process</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of threads per process that can</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">process_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the process manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the ProcessManager.</span>
<span class="sd">        process_names: The names of the processes.</span>
<span class="sd">        **kwargs: See below</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        log_level (str): The logging level of the ProcessManager.</span>
<span class="sd">        num_processes (int): The maximum number of processes.</span>
<span class="sd">        threads_per_process (int): The number of threads per process that can</span>
<span class="sd">        be run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check kwargs.</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid initializer argument: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Make sure that the ProcessManager is not already running.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;ProcessManager is already running. Try shutting it down first.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Change the name of the logger.</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Start the Process Manager.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Starting ProcessManager with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="si">}</span><span class="s2"> processes ...&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create the process name queue.</span>
    <span class="k">if</span> <span class="n">process_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">process_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Process </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">process_names</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Number of process names must be equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_process_names</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">process_names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_names</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">p_name</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>

    <span class="c1"># Create the process queue and populate it.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threads_per_process</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]  # noqa: E501</span>

    <span class="c1"># Create the process IDs queue.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_process_ids</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

    <span class="c1"># Create the process executor.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>

    <span class="c1"># Create the thread executor.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
        <span class="n">num_threads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads_per_process</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_threads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Starting the thread pool with </span><span class="si">{</span><span class="n">num_threads</span><span class="si">}</span><span class="s2"> threads ...&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]  # noqa: E501</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_active_threads</span> <span class="o">=</span> <span class="n">num_threads</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initializer</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.__new__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Creates a new ProcessManager instance if none exists.</p>
<p>Otherwise, returns the existing instance.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="preadator.process_manager.ProcessManager" href="#preadator.ProcessManager">ProcessManager</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A unique ProcessManager instance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002, ARG003</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003, ARG003</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProcessManager&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a new ProcessManager instance if none exists.</span>

<span class="sd">    Otherwise, returns the existing instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A unique ProcessManager instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_manager</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_manager</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.acquire_process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">acquire_process</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Acquires a lock for the current process.</p>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">acquire_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ProcessLock&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acquires a lock for the current process.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ProcessLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.acquire_thread" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">acquire_thread</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Acquires a lock for the current thread.</p>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">acquire_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ThreadLock&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acquires a lock for the current thread.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ThreadLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.join_processes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">join_processes</span><span class="p">(</span><span class="n">update_period</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Waits for all processes to finish.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>update_period</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The time in seconds between updates on the progress</p>
            </div>
          </td>
          <td>
                <code>30</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">join_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Waits for all processes to finish.</span>

<span class="sd">    Args:</span>
<span class="sd">        update_period: The time in seconds between updates on the progress</span>
<span class="sd">        of the processes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No processes to join.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">update_period</span><span class="p">,</span>
            <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_EXCEPTION</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">p</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processes progress: </span><span class="si">{</span><span class="n">progress</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">% ...&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All processes finished.&quot;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors occurred during process join. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;The first is: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.join_threads" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">join_threads</span><span class="p">(</span><span class="n">update_period</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Waits for all threads to finish.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>update_period</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The time in seconds between updates on the progress</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">join_threads</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912, C901</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">update_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Waits for all threads to finish.</span>

<span class="sd">    Args:</span>
<span class="sd">        update_period: The time in seconds between updates on the progress</span>
<span class="sd">        of the threads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No threads to join.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">update_period</span><span class="p">,</span>
            <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_EXCEPTION</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_job_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Threads progress: </span><span class="si">{</span><span class="n">progress</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">% ...&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All threads finished.&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="c1"># Steal threads from available processes.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_active_threads</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">num_new_threads</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">threads_per_process</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">,</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">num_new_threads</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads_per_request</span>

            <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">num_new_threads</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_active_threads</span> <span class="o">+=</span> <span class="n">num_new_threads</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Stole </span><span class="si">{</span><span class="n">num_new_threads</span><span class="si">}</span><span class="s2"> threads from processes.&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors occurred during thread join. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;The first is: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.shutdown" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Clean-up the resources associated with the Executor.</p>
<p>It is safe to call this method several times. Otherwise, no other
methods can be called after this one.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>wait</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to wait for all processes and threads to finish.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>cancel_futures</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to cancel pending futures.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912 (too-many-branches (13 &gt; 12))</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">cancel_futures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean-up the resources associated with the Executor.</span>

<span class="sd">    It is safe to call this method several times. Otherwise, no other</span>
<span class="sd">    methods can be called after this one.</span>

<span class="sd">    Args:</span>
<span class="sd">        wait: Whether to wait for all processes and threads to finish.</span>
<span class="sd">        cancel_futures: Whether to cancel pending futures.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shutting down the thread pool ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="n">cancel_futures</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shutting down the process pool ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="n">cancel_futures</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">p</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">join_threads</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join_processes</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_available_cpus</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: ignore[var-annotated]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors occurred during shutdown. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;The first is: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_main_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.submit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This defaults to <code>submit_process</code>.</p>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">submit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fn</span><span class="p">,</span>  <span class="c1"># noqa: ANN001</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This defaults to `submit_process`.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_process</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.submit_process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">submit_process</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Submits a callable to be executed with the given arguments.</p>
<p>Schedules the callable to be executed as fn(<em>args, </em>*kwargs) and returns
a Future instance representing the execution of the callable.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="concurrent.futures.Future">Future</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Future representing the given call.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">submit_process</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fn</span><span class="p">,</span>  <span class="c1"># noqa: ANN001</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submits a callable to be executed with the given arguments.</span>

<span class="sd">    Schedules the callable to be executed as fn(*args, **kwargs) and returns</span>
<span class="sd">    a Future instance representing the execution of the callable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Future representing the given call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="preadator.ProcessManager.submit_thread" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">submit_thread</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Submits a callable to be executed with the given arguments.</p>
<p>Schedules the callable to be executed as fn(<em>args, </em>*kwargs) and returns
a Future instance representing the execution of the callable.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="concurrent.futures.Future">Future</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Future representing the given call.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/preadator/process_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">submit_thread</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fn</span><span class="p">,</span>  <span class="c1"># noqa: ANN001</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="c1"># noqa: ANN002</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>  <span class="c1"># noqa: ANN003</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submits a callable to be executed with the given arguments.</span>

<span class="sd">    Schedules the callable to be executed as fn(*args, **kwargs) and returns</span>
<span class="sd">    a Future instance representing the execution of the callable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Future representing the given call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]  # noqa: E501</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="acknowledgements">Acknowledgements</h2>
<p>I want to thank my house plants for providing me with a negligible amount of oxygen each day.
Also, I want to thank the sun for providing more than half of their nourishment free of charge.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>